<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/producto.css" />
    <title>Productos - Home Sweet Home Treat</title>

    
 
    <style>
      /* Ajustes rápidos para que la tabla se vea bien al listar por categorías */
      .tipo-card { margin-bottom: 30px; border: 1px solid #e6e6e6; padding: 16px; border-radius: 6px; }
      .tipo-header { display:flex; align-items:center; justify-content:space-between; }
      .tipo-img { width:60px; height:60px; background-size:cover; background-position:center; border-radius:6px; margin-right:12px; }
      .producto-img { width:60px; height:60px; background-size:cover; background-position:center; border-radius:4px; }
      .form-small input, .form-small textarea { width:100%; margin-bottom:8px; padding:6px; }
      .form-inline { display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap; }
      .form-inline .field { flex:1; min-width:120px; }
    </style>
</head>
<body>
	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-md-8 text-center mb-4">
					<h2 class="heading-section">Productos</h2>
          <% if (mensaje) { %>
            <div style="background:#e8f5e9;padding:8px;border:1px solid #c8e6c9;margin-bottom:12px;border-radius:4px;color:#256029;">
              <%= mensaje %>
            </div>
          <% } %>
				</div>
			</div>

      <!-- Si no hay categorías -->
      <% if (!tipos || tipos.length === 0) { %>
        <div class="row">
          <div class="col-md-12">
            <p>No hay categorías (Tipo_Postre) en la base de datos.</p>
          </div>
        </div>
      <% } %>

      <!-- Listado por categoría -->
      <% tipos.forEach(function(tipo) { %>
        <div class="row tipo-card">
          <div class="col-12 tipo-header">
            <div style="display:flex;align-items:center;">
              <% if (tipo.ruta_imagen) { %>
                <div class="tipo-img" style="background-image:url('<%= tipo.ruta_imagen %>')"></div>
              <% } %>
              <div>
                <h3 style="margin:0;"><%= tipo.nombre_tipo %></h3>
                <% if (tipo.descripcion) { %>
                  <small><%= tipo.descripcion %></small>
                <% } %>
              </div>
            </div>
            <div>
              <!-- Botón para mostrar/ocultar productos (simple) -->
              <button onclick="var el=this.closest('.tipo-card').querySelector('.productos-wrap'); if(el.style.display==='none'){el.style.display='block'; this.innerText='Ocultar';}else{el.style.display='none'; this.innerText='Ver productos';}">Ver productos</button>
            </div>
          </div>

          <div class="col-12 productos-wrap" style="margin-top:12px;">
            <div class="table-wrap">
              <table class="table" style="width:100%;border-collapse:collapse;">
                <thead>
                  <tr style="background:#f7f7f7;">
                    <th></th>
                    <th>Producto</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Descripción</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (tipo.productos && tipo.productos.length>0) { %>
                    <% tipo.productos.forEach(function(p) { %>
                      <tr>
                        <td>
                          <% if (p.ruta_imagen) { %>
                            <div class="producto-img" style="background-image:url('<%= p.ruta_imagen %>')"></div>
                          <% } else { %>
                            <div class="producto-img" style="background:#efefef;display:flex;align-items:center;justify-content:center;color:#999;">Sin foto</div>
                          <% } %>
                        </td>
                        <td>
                          <strong><%= p.nombre_postre %></strong>
                        </td>
                        <td>
                          <% if (p.precio !== null) { %>
                            $<%= Number(p.precio).toFixed(2) %>
                          <% } else { %>
                            --
                          <% } %>
                        </td>
                        <td><%= p.stock %></td>
                        <td style="max-width:320px;"><%= p.descripcion ? p.descripcion : '' %></td>
                      </tr>
                    <% }) %>
                  <% } else { %>
                    <tr><td colspan="5">No hay productos en esta categoría.</td></tr>
                  <% } %>
                </tbody>
              </table>
            </div>

            <!-- Formulario para agregar producto a esta categoría -->
            <div style="margin-top:12px;border-top:1px dashed #ddd;padding-top:12px;">
              <h4>Agregar producto a "<%= tipo.nombre_tipo %>"</h4>
              <form action="/productos" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="tipo_id" value="<%= tipo.tipo_id %>">
                <div class="form-inline">
                  <div class="field">
                    <label>Nombre</label>
                    <input type="text" name="nombre_postre" required placeholder="Ej: Pastel de vainilla">
                  </div>
                  <div class="field">
                    <label>Precio</label>
                    <input type="number" name="precio" step="0.01" min="0" required placeholder="0.00">
                  </div>
                  <div class="field">
                    <label>Stock</label>
                    <input type="number" name="stock" min="0" value="0" placeholder="0">
                  </div>
                  <div class="field">
                    <label>Imagen (opcional)</label>
                    <input type="file" name="imagen" accept="image/*">
                  </div>
                  <div style="flex-basis:100%;"></div>
                  <div class="field" style="flex:1;">
                    <label>Descripción</label>
                    <textarea name="descripcion" rows="2" placeholder="Descripción corta"></textarea>
                  </div>
                  <div style="align-self:flex-end;">
                    <button type="submit">Agregar producto</button>
                  </div>
                </div>
              </form>
            </div>

          </div>
        </div>
      <% }) %>

		</div>
	</section>


	<script src="/js/productosA.js"></script>
</body>
</html>